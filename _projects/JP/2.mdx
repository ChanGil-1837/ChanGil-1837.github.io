![Image 1](/_projects/2/1.gif)

## 1. 始まりは微力だったが、その終わりは壮大…になるだろうか？

![Image 2](/_projects/2/2.png)

ゲーム開発をしていると、誰もが一度は直面する巨大な山があります。それはセリフ管理です。
Excelシート、テキストファイル、さらにはコードへのハードコーディングまで…セリフが長くなり、選択肢が増えるほど、作業は地獄のようになっていきました。
<br/>
そして、視覚的に表現できない分、企画者にとってセリフ編集はすなわち **コーディング** になってしまいます。
<br/>

> 「このセリフの次には何が来るんだ？」
> 「この選択肢を選ぶと、どんなイベントが発生するんだ？」

こんな質問の答えを見つけるために、数多くのファイルをさまよう姿を見て決心しました。

> 「そうだ、自分で作ろう。対話の流れが一目でわかる視覚的なツールを！」

<br/>
---
<br/>

## 1.5 実はアプリを作るつもりはなかった…！

最初からアプリを作るつもりは全くありませんでした。
下の動画で紹介されているUnity GraphView SDKを勉強しながら、自分が必要とする機能だけを選んで修正し、エディタを作るだけで十分だと考えていました。
![Image 3](/_projects/2/3.png)
[動画リンク](https://www.youtube.com/watch?v=nvELzBYMK1U&list=PL0yxB6cCkoWK38XT5stSztcLueJ_kTx5f)

Unity Graph View SDKを活用して、Unityで動作するエディタをその動画を見て勉強し、自分が使う内容に修正しました。
約8ヶ月の期間をかけて完成させましたが…「新しい酒は新しい革袋に」という聖賢の教えに従い、外付けSSDに入れてフォーマットをかけたところ…

なんと…SSDが壊れてしまいました。
![Image 4](/_projects/2/4.png)
原因を調べてみると、問題は **exFATファイルシステム** でした。
![Image 5](/_projects/2/5.png)

MacとWindowsを同時に使っていたので、外付けハードディスクを共有するしかなかったのですが、exFATは便利な代わりに不良セクタに弱いという致命的な欠点があったのです。
<br/>
その瞬間、8ヶ月間の努力が虚しく蒸発しました。
しかし、ここで止まるわけにはいきませんでした。
> 「いっそ最初から作り直す」

結局、Pythonベースの新しいツールを開発することに決心しました。
<br/>
---
<br/>
## 2. 技術スタックの選択：なぜPyQt5だったのか？

最初の悩みは「どんな技術で作るか」でした。
素早くプロトタイプを作りたかったし、GUIフレームワークが必要でした。Tkinter、Kivyなど、いくつかの候補がありましたが、私の目を引いたのは **PyQt5** でした。

### PyQt5を選んだ理由
<br/>
**強力なQGraphicsScene/Viewフレームワーク**
  ノードとその間をつなぐ接続線（エッジ）を描き、マウスクリックやドラッグを処理するのに、これほど適したツールはありませんでした。
  <br/>
  <br/>
**シグナル/スロットメカニズム**
  オブジェクト間の通信をきれいに処理できました。
  例えば、「データが変わったら（シグナル）、画面を再描画しろ（スロット）」のようなロジックを直感的に実装できました。
  <br/>
  <br/>
**豊富なウィジェットと強力なカスタマイズ**
  標準で提供されるUI要素が豊富で、QSS（Qt Style Sheet）を通じてCSSのようにデザインを変えられるのも大きな利点でした。
<br/>
<br/>
そして個人的にMac環境で作業しており、このセリフエディタを使うユーザーはWindowsであることを考慮して、Pythonで制作することに決めました。
<br/>
---
<br/>
# 3. 第一歩：「ノーマルノード」と「選択肢ノード」
![Image 6](/_projects/2/6.gif)
エディタの心臓部はまさに **ノード** です。

最初に作ったのは、基本的なセリフを入れる **ノーマルノード（Normal Node）** でした。
画面に四角い箱を描き、その中にセリフを入力できる簡単な形でした。
入力点と出力点を作ってノード同士を接続線でつなぐと、かなり「エディタらしい」見た目になりました。
![Image 7](/_projects/2/7.png)
本当の挑戦は **選択肢ノード（Choice Node）** から始まりました。
このノードは、一つの入力と複数の出力を持つ必要がありました。
ユーザーが選択肢の数を自由に追加したり削除したりできなければならず、各出力線ごとにその選択肢のテキストを表示する必要がありました。
データ構造が急激に複雑になりましたが、このノードを完成させると、ついにシナリオの分岐を作れるようになり、その瞬間の達成感は言葉では言い表せませんでした。
<br/>
---
<br/>
# 4. ディテールの力：「名前指定」と「ドラッグ＆ドロップ」

流れを作ると、欲が出てきました。
> 「どのキャラクターがこのセリフを言っているのか表示できたらいいな！」

![Image 9](/_projects/2/8.gif)
そこで **名前指定機能** を入れました。
別のリストウィジェットに「ニナ」「アレックス」のようなキャラクター名をあらかじめ登録しておき、ノード内でドロップダウンで選択できるようにしたのです。
単純な機能でしたが、可読性は大幅に向上しました。
![Image 8](/_projects/2/12.png)
- 名前に応じてノードの色も変更
<br/>
<br/>
![Image 10](/_projects/2/9.gif)
次に力を入れたのは **イベントノード** でした。
単にメニューから「イベントノード生成」を押すのは味気ないと思いました。
そこで、画面の片隅にイベントリスト（例：「ドアを開ける」「アイテム獲得」）を表示しておき、目的のイベントを **マウスでドラッグ＆ドロップ** するだけで、その場ですぐにイベントノードが生成されるようにしました。

このために `dragEnterEvent`、`dropEvent` をオーバーライドしましたが、ユーザーがより直感的にエディタを扱えるようになり、満足感が非常に大きかったです。
この過程を経て、「ああ、これがUXを考えるということなんだな」という悟りも得ました。
<br/>
---
<br/>
# 5.しまった、条件分岐文も必要だ！

ツールを作っていると、単に入力を受け取って出力するだけでは不十分な時があります。
ユーザーの選択や状況に応じて、異なる流れを処理しなければならない場合が必ず出てきます。
![Image 11](/_projects/2/10.gif)
<br/>
最初は単純な自動化だけを考えていました。繰り返される作業を少しでも減らし、チームメンバーが同じフォーマットで資料を渡せるように手助けする目的でした。
しかし、いざ作業を進めてみると、条件分岐や例外処理といった要素を考慮しないと、すぐに限界が見えてきました。
その過程で、「しまった、これも必要だったのか」という気づきを得ることになりました。
<br/>
---
<br/>
## 5.5 その他にも...

もちろん、単に動作するだけのツールでは不十分でした。

**最後の参照位置を記憶**：ファイルを読み込む際、ユーザーが最後にアクセスしたパスを自動的に記憶
**ドラッグ＆ドロップでの読み込み**：セーブファイルを単にドラッグ＆ドロップするだけで読み込めるように利便性を強化
**中間保存（バックアップ機能）**：作業中に突発的な状況が発生してもデータが失われないように、定期的な一時保存機能
**バージョン互換性への対応**：アップデートによってデータ構造が変わる可能性があるため、NullExceptionを防ぐための安全装置を用意
![Image 12](/_projects/2/11.gif)
結局、このような細かい部分が積み重なり、単なる「ツール」ではなく、実際に長期間信頼できる環境になるようにすることが目標でした。
こうして、ある程度「アプリケーション」らしい姿が見え始めました。
<br/>
---
<br/>
# 6. これからの道

まだ行くべき道は長いです。

家内手工業のように一つ一つ作っていくツール制作の過程は非常に楽しかったですが、まだ解決すべきバグが残っています。
それでも、ユーザーが私が作ったエディタを通じて資料を渡してくれる時には、大きなやりがいを感じます。
特に、私が作ったフォーマットでセリフを渡してくれるので、ミスが減り、全体の作業の統一性も高まる効果を得ることができました。

もし私のように自分だけのツール制作を夢見ている方がいらっしゃれば、ためらわずに今すぐ始めてみることをお勧めしたいです。
その過程で得られる経験と達成感は、成果物そのものよりも価値のある資産になるでしょうから。

<br/>
---
<br/>
## 関連リンク

<OpenProjectLink slug="5">Dialogue Calendar プロジェクト紹介</OpenProjectLink>
[完成版サンプル](https://github.com/ChanGil-1837/Avalonia_DialogueCalendarApp)
[参考にした動画](https://www.youtube.com/watch?v=xbTLhMJARrk&list=PLZSNHzwDCOggHLThIbCxUhWTgrKVemZkz)